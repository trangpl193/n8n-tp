{
  "meta": {
    "instanceId": "strangematic-n8n-production"
  },
  "nodes": [
    {
      "parameters": {
        "updates": [
          "message"
        ],
        "additionalFields": {}
      },
      "id": "telegram-webhook-trigger-v2",
      "name": "Telegram Bot Webhook",
      "type": "n8n-nodes-base.telegramTrigger",
      "typeVersion": 1.1,
      "position": [
        240,
        400
      ],
      "webhookId": "telegram-yescale-bot-v2",
      "credentials": {
        "telegramApi": {
          "id": "telegram-bot-credentials",
          "name": "Telegram Bot API"
        }
      }
    },
    {
      "parameters": {
        "values": {
          "string": [
            {
              "name": "user_message",
              "value": "={{ $json.message.text.toLowerCase().trim() }}"
            },
            {
              "name": "chat_id",
              "value": "={{ $json.message.chat.id }}"
            },
            {
              "name": "user_name",
              "value": "={{ $json.message.from.first_name || 'User' }}"
            },
            {
              "name": "message_id",
              "value": "={{ $json.message.message_id }}"
            }
          ]
        },
        "options": {}
      },
      "id": "extract-message-data",
      "name": "Extract Message Data",
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        460,
        400
      ]
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": false,
            "leftValue": "",
            "typeValidation": "loose"
          },
          "conditions": [
            {
              "id": "condition-api-request",
              "leftValue": "={{ $json.user_message }}",
              "rightValue": "(api|key)(?!.*model)|danh s√°ch.*api|list.*api|available.*api|show.*api|xem.*api|api.*n√†o|c√≥.*api.*g√¨",
              "operator": {
                "type": "string",
                "operation": "regex"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "id": "detect-api-request",
      "name": "Detect API Request",
      "type": "n8n-nodes-base.if",
      "typeVersion": 2,
      "position": [
        680,
        300
      ]
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": false,
            "leftValue": "",
            "typeValidation": "loose"
          },
          "conditions": [
            {
              "id": "condition-model-request",
              "leftValue": "={{ $json.user_message }}",
              "rightValue": "model|danh s√°ch.*model|list.*model|available.*model|show.*model|xem.*model|model.*n√†o|c√≥.*model.*g√¨|ai.*model",
              "operator": {
                "type": "string",
                "operation": "regex"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "id": "detect-model-request",
      "name": "Detect Model Request",
      "type": "n8n-nodes-base.if",
      "typeVersion": 2,
      "position": [
        680,
        500
      ]
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": false,
            "leftValue": "",
            "typeValidation": "loose"
          },
          "conditions": [
            {
              "id": "condition-help-request",
              "leftValue": "={{ $json.user_message }}",
              "rightValue": "help|h∆∞·ªõng d·∫´n|guide|start|begin|b·∫Øt ƒë·∫ßu|gi√∫p|tr·ª£ gi√∫p|l√†m g√¨|c√≥ th·ªÉ|ch·ª©c nƒÉng|/start|hello|hi|xin ch√†o",
              "operator": {
                "type": "string",
                "operation": "regex"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "id": "detect-help-request",
      "name": "Detect Help Request",
      "type": "n8n-nodes-base.if",
      "typeVersion": 2,
      "position": [
        680,
        700
      ]
    },
    {
      "parameters": {
        "url": "https://yescale.bogia.app/yescale/user",
        "authentication": "genericCredentialType",
        "genericAuthType": "httpHeaderAuth",
        "options": {}
      },
      "id": "get-user-info",
      "name": "Get User Info",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        900,
        200
      ],
      "credentials": {
        "httpHeaderAuth": {
          "id": "yescale-auth-header",
          "name": "YEScale Auth Header"
        }
      }
    },
    {
      "parameters": {
        "url": "https://yescale.bogia.app/yescale/apikeylist",
        "authentication": "genericCredentialType",
        "genericAuthType": "httpHeaderAuth",
        "options": {}
      },
      "id": "get-api-keys",
      "name": "Get API Keys",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        1120,
        200
      ],
      "credentials": {
        "httpHeaderAuth": {
          "id": "yescale-auth-header",
          "name": "YEScale Auth Header"
        }
      }
    },
    {
      "parameters": {
        "url": "https://yescale.bogia.app/yescale/models",
        "authentication": "genericCredentialType",
        "genericAuthType": "httpHeaderAuth",
        "options": {}
      },
      "id": "get-models",
      "name": "Get Models",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        900,
        400
      ],
      "credentials": {
        "httpHeaderAuth": {
          "id": "yescale-auth-header",
          "name": "YEScale Auth Header"
        }
      }
    },
    {
      "parameters": {
        "resource": "message",
        "operation": "sendMessage",
        "chatId": "={{ $node['Extract Message Data'].json.chat_id }}",
        "text": "={{ 'üîë **Xin ch√†o ' + $node['Extract Message Data'].json.user_name + '!**\\n\\nüìä **Th√¥ng tin t√†i kho·∫£n YEScale:**\\n‚Ä¢ üë§ T√™n: ' + $node['Get User Info'].json.data.display_name + '\\n‚Ä¢ üìß Email: ' + $node['Get User Info'].json.data.email + '\\n‚Ä¢ üí∞ Quota c√≤n l·∫°i: $' + ($node['Get User Info'].json.data.quota / 500000).toFixed(2) + '\\n‚Ä¢ üî• ƒê√£ s·ª≠ d·ª•ng: $' + ($node['Get User Info'].json.data.used_quota / 500000).toFixed(2) + '\\n‚Ä¢ üìà S·ªë request: ' + $node['Get User Info'].json.data.request_count + '\\n\\nüîê **API Keys c√≥ s·∫µn:**\\n' + $node['Get API Keys'].json.data.slice(0, 5).map((key, index) => (index + 1) + '. **' + key.name + '**\\n   ‚Ä¢ ' + (key.status === 1 ? '‚úÖ Ho·∫°t ƒë·ªông' : '‚ùå Kh√¥ng ho·∫°t ƒë·ªông') + '\\n   ‚Ä¢ Quota: ' + (key.unlimited_quota ? '‚ôæÔ∏è Kh√¥ng gi·ªõi h·∫°n' : '$' + (key.remain_quota / 500000).toFixed(2)) + '\\n').join('\\n') + ($node['Get API Keys'].json.data.length > 5 ? '\\n... v√† ' + ($node['Get API Keys'].json.data.length - 5) + ' keys kh√°c\\n\\n' : '\\n') + 'üìä **T·ªïng c·ªông:** ' + $node['Get API Keys'].json.data.length + ' API keys (' + $node['Get API Keys'].json.data.filter(key => key.status === 1).length + ' ƒëang ho·∫°t ƒë·ªông)' }}",
        "additionalFields": {
          "parse_mode": "Markdown",
          "disable_web_page_preview": true
        }
      },
      "id": "send-api-response",
      "name": "Send API Response",
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        1340,
        200
      ],
      "credentials": {
        "telegramApi": {
          "id": "telegram-bot-credentials",
          "name": "Telegram Bot API"
        }
      }
    },
    {
      "parameters": {
        "resource": "message",
        "operation": "sendMessage",
        "chatId": "={{ $node['Extract Message Data'].json.chat_id }}",
        "text": "={{ 'ü§ñ **Xin ch√†o ' + $node['Extract Message Data'].json.user_name + '!**\\n\\nüìã **Danh s√°ch Models c√≥ s·∫µn:**\\n\\n' + Object.entries($node['Get Models'].json.data.filter(model => model.uptime === 1 && model.is_deprecation === 0).reduce((acc, model) => { const category = model.category || 'Kh√°c'; if (!acc[category]) acc[category] = []; acc[category].push({ name: model.model_name, provider: model.provider_name, price: model.price_per_request, endpoint: model.endpoint }); return acc; }, {})).slice(0, 8).map(([category, models]) => '**üìÇ ' + category + ':**\\n' + models.slice(0, 3).map((model, index) => (index + 1) + '. `' + model.name + '`\\n   üè¢ Provider: ' + model.provider + '\\n   üí∞ Gi√°: ' + model.price + ' token/request\\n   üîó Endpoint: ' + model.endpoint).join('\\n') + (models.length > 3 ? '\\n   ... v√† ' + (models.length - 3) + ' models kh√°c' : '')).join('\\n\\n') + '\\n\\nüìä **Th·ªëng k√™:**\\n‚Ä¢ ‚úÖ Models ho·∫°t ƒë·ªông: ' + $node['Get Models'].json.data.filter(model => model.uptime === 1 && model.is_deprecation === 0).length + '\\n‚Ä¢ üîß ƒêang b·∫£o tr√¨: ' + $node['Get Models'].json.data.filter(model => model.uptime === 0).length + '\\n‚Ä¢ ‚ö†Ô∏è Deprecated: ' + $node['Get Models'].json.data.filter(model => model.is_deprecation === 1).length + '\\n‚Ä¢ üìà T·ªïng c·ªông: ' + $node['Get Models'].json.data.length + ' models' }}",
        "additionalFields": {
          "parse_mode": "Markdown",
          "disable_web_page_preview": true
        }
      },
      "id": "send-model-response",
      "name": "Send Model Response",
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        1120,
        400
      ],
      "credentials": {
        "telegramApi": {
          "id": "telegram-bot-credentials",
          "name": "Telegram Bot API"
        }
      }
    },
    {
      "parameters": {
        "resource": "message",
        "operation": "sendMessage",
        "chatId": "={{ $node['Extract Message Data'].json.chat_id }}",
        "text": "={{ 'üëã **Xin ch√†o ' + $node['Extract Message Data'].json.user_name + '!**\\n\\nü§ñ **YEScale Bot - Tr·ª£ l√Ω API th√¥ng minh**\\n\\nüìñ **H∆∞·ªõng d·∫´n s·ª≠ d·ª•ng:**\\n\\nüîπ **Xem danh s√°ch API Keys:**\\n   ‚Ä¢ `api` - Xem t·∫•t c·∫£ API keys\\n   ‚Ä¢ `danh s√°ch api` - API keys c√≥ s·∫µn\\n   ‚Ä¢ `show me the apis` - Hi·ªÉn th·ªã APIs\\n\\nüîπ **Xem danh s√°ch Models:**\\n   ‚Ä¢ `models` - Xem t·∫•t c·∫£ models\\n   ‚Ä¢ `danh s√°ch model` - Models c√≥ s·∫µn\\n   ‚Ä¢ `what models are available?` - Models kh·∫£ d·ª•ng\\n\\nüîπ **Tr·ª£ gi√∫p:**\\n   ‚Ä¢ `help` - Hi·ªÉn th·ªã h∆∞·ªõng d·∫´n n√†y\\n   ‚Ä¢ `h∆∞·ªõng d·∫´n` - H∆∞·ªõng d·∫´n ti·∫øng Vi·ªát\\n\\nüí° **M·∫πo:** Bot hi·ªÉu c·∫£ ti·∫øng Vi·ªát v√† ti·∫øng Anh!\\n\\nüöÄ **Ph√°t tri·ªÉn b·ªüi:** [Strangematic](https://strangematic.com)\\nüìö **Documentation:** [YEScale API Docs](https://im06lq19wz.apifox.cn/doc-7023075)' }}",
        "additionalFields": {
          "parse_mode": "Markdown",
          "disable_web_page_preview": false
        }
      },
      "id": "send-help-response",
      "name": "Send Help Response",
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        900,
        600
      ],
      "credentials": {
        "telegramApi": {
          "id": "telegram-bot-credentials",
          "name": "Telegram Bot API"
        }
      }
    },
    {
      "parameters": {
        "resource": "message",
        "operation": "sendMessage",
        "chatId": "={{ $node['Extract Message Data'].json.chat_id }}",
        "text": "={{ '‚ùì **Kh√¥ng hi·ªÉu y√™u c·∫ßu c·ªßa b·∫°n**\\n\\nXin ch√†o ' + $node['Extract Message Data'].json.user_name + '! T√¥i kh√¥ng hi·ªÉu \"' + $node['Extract Message Data'].json.user_message + '\"\\n\\nü§ñ **T√¥i c√≥ th·ªÉ gi√∫p b·∫°n:**\\n‚Ä¢ `api` - Xem danh s√°ch API keys\\n‚Ä¢ `models` - Xem danh s√°ch models\\n‚Ä¢ `help` - H∆∞·ªõng d·∫´n s·ª≠ d·ª•ng\\n\\nüí¨ **V√≠ d·ª• c√¢u h·ªèi:**\\n‚Ä¢ \"C√≥ nh·ªØng API n√†o?\"\\n‚Ä¢ \"Show me available models\"\\n‚Ä¢ \"Danh s√°ch model AI\"\\n\\nüìù **G·ª£i √Ω:** H√£y s·ª≠ d·ª•ng c√°c t·ª´ kh√≥a nh∆∞ \"api\", \"model\", \"list\" ho·∫∑c \"danh s√°ch\"' }}",
        "additionalFields": {
          "parse_mode": "Markdown",
          "disable_web_page_preview": true
        }
      },
      "id": "send-unknown-response",
      "name": "Send Unknown Response",
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        900,
        800
      ],
      "credentials": {
        "telegramApi": {
          "id": "telegram-bot-credentials",
          "name": "Telegram Bot API"
        }
      }
    },
    {
      "parameters": {
        "resource": "message",
        "operation": "sendMessage",
        "chatId": "={{ $node['Extract Message Data'].json.chat_id }}",
        "text": "={{ '‚ùå **L·ªói k·∫øt n·ªëi YEScale API**\\n\\nXin l·ªói ' + $node['Extract Message Data'].json.user_name + ', ƒë√£ x·∫£y ra l·ªói khi k·∫øt n·ªëi v·ªõi YEScale API.\\n\\nüîß **Kh·∫Øc ph·ª•c:**\\n‚Ä¢ Ki·ªÉm tra k·∫øt n·ªëi internet\\n‚Ä¢ Th·ª≠ l·∫°i sau v√†i ph√∫t\\n‚Ä¢ Li√™n h·ªá admin n·∫øu v·∫•n ƒë·ªÅ v·∫´n ti·∫øp t·ª•c\\n\\nüìû **H·ªó tr·ª£:** admin@strangematic.com\\n‚è∞ **Th·ªùi gian:** ' + new Date().toLocaleString('vi-VN') + '\\n\\nü§ñ **Error Code:** API_CONNECTION_FAILED' }}",
        "additionalFields": {
          "parse_mode": "Markdown",
          "disable_web_page_preview": true
        }
      },
      "id": "send-error-response",
      "name": "Send Error Response",
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        1340,
        600
      ],
      "credentials": {
        "telegramApi": {
          "id": "telegram-bot-credentials",
          "name": "Telegram Bot API"
        }
      }
    }
  ],
  "connections": {
    "Telegram Bot Webhook": {
      "main": [
        [
          {
            "node": "Extract Message Data",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Extract Message Data": {
      "main": [
        [
          {
            "node": "Detect API Request",
            "type": "main",
            "index": 0
          },
          {
            "node": "Detect Model Request",
            "type": "main",
            "index": 0
          },
          {
            "node": "Detect Help Request",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Detect API Request": {
      "main": [
        [
          {
            "node": "Get User Info",
            "type": "main",
            "index": 0
          }
        ],
        []
      ]
    },
    "Detect Model Request": {
      "main": [
        [
          {
            "node": "Get Models",
            "type": "main",
            "index": 0
          }
        ],
        []
      ]
    },
    "Detect Help Request": {
      "main": [
        [
          {
            "node": "Send Help Response",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Send Unknown Response",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get User Info": {
      "main": [
        [
          {
            "node": "Get API Keys",
            "type": "main",
            "index": 0
          }
        ]
      ],
      "error": [
        [
          {
            "node": "Send Error Response",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get API Keys": {
      "main": [
        [
          {
            "node": "Send API Response",
            "type": "main",
            "index": 0
          }
        ]
      ],
      "error": [
        [
          {
            "node": "Send Error Response",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get Models": {
      "main": [
        [
          {
            "node": "Send Model Response",
            "type": "main",
            "index": 0
          }
        ]
      ],
      "error": [
        [
          {
            "node": "Send Error Response",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "pinData": {},
  "settings": {
    "executionOrder": "v1",
    "saveManualExecutions": true,
    "callerPolicy": "workflowsFromSameOwner",
    "errorWorkflow": {
      "id": "error-handler-workflow"
    },
    "timezone": "Asia/Ho_Chi_Minh"
  },
  "staticData": null,
  "tags": [
    {
      "createdAt": "2025-08-02T08:15:00.000Z",
      "updatedAt": "2025-08-02T08:15:00.000Z",
      "id": "telegram-yescale-bot-v2",
      "name": "Telegram YEScale Bot V2"
    },
    {
      "createdAt": "2025-08-02T08:15:00.000Z",
      "updatedAt": "2025-08-02T08:15:00.000Z",
      "id": "automation",
      "name": "Automation"
    },
    {
      "createdAt": "2025-08-02T08:15:00.000Z",
      "updatedAt": "2025-08-02T08:15:00.000Z",
      "id": "nlp",
      "name": "Natural Language Processing"
    }
  ],
  "triggerCount": 0,
  "updatedAt": "2025-08-02T08:15:00.000Z",
  "versionId": "2"
}
